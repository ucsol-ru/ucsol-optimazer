/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

(function($){$.fn["profiles"]=function(source){var $this=this.first(),select=$.merge($("> select",$this),$("select.profile")),items=$(".items",$this);$('[data-profile][data-profile!="default"] > li').each(function(){$(this).children(".wlabel").before($('<input class="ignore" type="checkbox" />').attr("checked",!$(this).hasClass("ignore")))});show("default");$("#config").delegate("input.ignore","change",function(e){$(this).is(":checked")?$(this).closest("li").removeClass("ignore"):$(this).closest("li").addClass("ignore")});$(select[0]).bind("change",function(e){show($(this).val())});$("> a.add",$this).bind("click",function(e){e.preventDefault();add(prompt("Please enter a profile name"))});$("> a.rename",$this).bind("click",function(e){e.preventDefault();var from=$(select[0]).val();var to=prompt("Please enter a profile name",from);rename(from,to)});$("> a.remove",$this).bind("click",function(e){e.preventDefault();remove($(select[0]).val())});$("> a.assign",$this).bind("click",function(e){e.preventDefault();assign($(select[0]).val())});$("select",items).bind("blur",function(e){update($(select[0]).val());items.hide()});function show(name){if(name=="default"){$this.addClass("default")}else{$this.removeClass("default")}$("[data-profile]").not($('[data-profile="'+name+'"]').show()).hide()}function add(name){if(name&&!$('option[value="'+name+'"]',select[0]).length){var profile=$(source).clone(true).attr("data-profile",name);profile.find('[name^="profile_data"]').attr("name",function(i,value){return value.replace("profile_data[default]","profile_data["+name+"]")});profile.children("li").each(function(){$(this).addClass("ignore").children(".wlabel").before('<input class="ignore" type="checkbox" />')});profile.appendTo($(source).parent());select.append('<option value="'+name+'">'+name+"</option>");$(select[0]).val(name).trigger("change")}}function rename(from,to){if(to&&from!=to&&!$('option[value="'+to+'"]',select[0]).length){$('[data-profile="'+from+'"]').attr("data-profile",to).find('[name^="profile_data"]').attr("name",function(i,value){return value.replace("profile_data["+from+"]","profile_data["+to+"]")});$('input[name^="profile_map"][value="'+from+'"]',$this).attr("value",to);select.find('option[value="'+from+'"]').attr("value",to).html(to)}}function remove(name){$('[data-profile="'+name+'"]').remove();$('input[name^="profile_map"][value="'+name+'"]',$this).remove();select.find('option[value="'+name+'"]').remove();$(select[0]).trigger("change")}function assign(name){items.find("option:selected").attr("selected",false);items.find("option:disabled").attr("disabled",false);$('input[type="hidden"]',$this).each(function(){var page=$(this).attr("name").replace(/^profile_map\[(.*)\]$/i,"$1");var attr=$(this).val()==name?"selected":"disabled";items.find('[value="'+page+'"]').attr(attr,true)});items.show().find("select").focus()}function update(name){$('input[name^="profile_map"][value="'+name+'"]',$this).remove();items.find("option:selected").each(function(){$this.append('<input type="hidden" name="profile_map['+$(this).val()+']" value="'+name+'" />')})}return this};var Storage={get:function(name){return window["sessionStorage"]?sessionStorage.getItem(name):0},set:function(name,val){if(window["sessionStorage"]){sessionStorage.setItem(name,val)}}};$.fn["tabs"]=function(){return this.each(function(){var content=$(this).addClass("content").wrap('<div class="tabs-box" />').before('<ul class="nav" />');var navigation=$(this).prev("ul.nav");content.children("li").each(function(){navigation.append("<li><a>"+$(this).hide().attr("data-name")+"</a></li>")});navigation.children("li").bind("click",function(e){e.preventDefault();var index=$("li",navigation).removeClass("active").index($(this).addClass("active").get(0));var tabs=content.children("li").hide();$(tabs[index]).show();Storage.set("warp.settings.index",index)});var index=Storage.get("warp.settings.index")?Storage.get("warp.settings.index"):0,childs=navigation.children();if(index>=childs.length){index=0}childs.eq(index).trigger("click")})}})(jQuery);