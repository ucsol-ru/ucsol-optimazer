/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

jQuery(function($){var config=$("#config"),profile=$("#profile"),submitbutton=Joomla.submitbutton,storage=window["sessionStorage"]||{};$("#myTabTabs").on("click","[data-toggle]",function(){storage["_tab"]=$(this).attr("href")});setTimeout(function(){if(storage["_tab"]){$("#myTabTabs [href='"+storage["_tab"]+"']").trigger("click")}},1);Joomla.submitbutton=function(task){var form=$('form[name="adminForm"]');if(task=="style.save"){form.trigger("save",["save",task])}else if(task=="style.save2copy"){form.trigger("save",["save-copy",task])}else if(task=="style.apply"){form.trigger("save",["apply",task])}else{submitbutton(task)}};if($("#templatestyleOptions").length){config.closest("#templatestyleOptions").before(config).remove()}else{config.closest("#details").find("div:first").before(config).hide()}setTimeout(function(){config.find(".chzn-container").each(function(){$(this).prev().show().end().remove()})},200);config.tabs();profile.prependTo("#config li.Profiles").profiles('[data-profile="default"]');if($(window).width()<1200){$("div.tabs-box").addClass("small-screen")}config.prev("ul.nav").append('<li class="version">Warp '+config.data("warpversion")+"</li>");var verify=$("#config ul.verify").hide();$("#config a.verify-link").bind("click",function(e){e.preventDefault();verify.slideToggle()});var systemcheck=$("#config ul.systemcheck").hide();$("#config a.systemcheck-link").bind("click",function(e){e.preventDefault();systemcheck.slideToggle()});$('form[name="adminForm"]').bind("save",function(e,action,task){var post={},ignore=[],form=$(this),button=$("#toolbar-"+action);button.addClass("saving");$("#config li.ignore > .field").find("input, select, textarea").each(function(){ignore.push($(this).attr("name"))});$.each(form.serializeArray(),function(i,field){if($.inArray(field.name,ignore)>-1)return;post[field.name]=field.value});$.ajax({url:form.attr("action"),type:"post",data:$.extend(post,{option:"com_templates",tmpl:"warp-ajax"}),success:function(data){button.removeClass("saving");try{data=$.parseJSON(data);if(data.message!="success"){alert("Save failed!");return}}catch(e){}submitbutton(task)}})})});